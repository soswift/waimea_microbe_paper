"0","## normal barplots"
"0","# count N observations for columns"
"0","troph_data <- samples[ , .N, by = .(habitat, common_name, trophic)]"
"0","# assign a new placeholder columns group and key"
"0","troph_data$group <- troph_data$habitat"
"0","troph_data$key <- paste(troph_data$habitat, troph_data$common_name)"
"0","# filter out samples with no habitat (controls)"
"0","troph_data <- na.omit(troph_data, cols=""habitat"")"
"0","## generate unique ids for each bar"
"0","ids <- troph_data[ , .(tot=sum(N)), .(key,habitat)][order(habitat,tot)]"
"0","ids$id <- 1:nrow(ids)"
"0","# join ids with the rest of trophic data"
"0","setkey(troph_data, habitat, key)"
"0","setkey(ids, habitat,key) "
"0","troph_data <- merge(troph_data,ids, all.x = T)"
"0","troph_data <- troph_data[order(habitat, tot)]"
"0","habitats <- unique(troph_data$habitat)"
"0","# make a summary barplot for each habitat"
"0","b_plots <- list()"
"0","for (a in seq_along(habitats)) {"
"0","  "
"0","  habidata <- troph_data[troph_data$habitat == habitats[a],]"
"0","  "
"0","b_plots[[a]] <- ggplot(data=habidata, aes(x=reorder(common_name,id), y = N, fill=trophic)) +"
"0","  geom_bar(stat = ""identity"") +"
"0","  labs(fill =""Trophic Level"")+"
"0","  scale_fill_manual(values = trophic_colors)+"
"0","  coord_flip()+"
"0","  labs(y = """", x = """", title = habitats[a])+"
"0","  ylim(0,150)"
"0","print(b_plots[[a]])"
"0","ggsave(file = paste(""outputs/summary/habitat_"", habitats[a],""_barplot.pdf"",sep = """"),"
"0","       plot = b_plots[[a]], device = ""pdf"", width = 10, height = 10, dpi = 400)"
"0","}"
